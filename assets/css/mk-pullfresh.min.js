!function(t,i,e){function s(i,e,s){this.element=i,this.options=t.extend({},r,s),this.options.refresh=e,this.$puller=t(this.element),this.puller=this.element,this.$container=this.$puller.parent(),this.$bubble=t('<div class="mk-pullfresh-bubble">').prependTo(this.$puller),this.$bubble.append(this.options.indicatorHtml),this.bubble=this.$bubble.get(0),this.$container.css({"-webkit-overflow-scrolling":"touch","overflow-scrolling":"touch"}),this.offset={containerToDoc:this.$container.offset().top,pullerToContainer:this.$container.position().top},this.pointer={start:null,y:null,shift:null},this.elast=!0,this.$puller.unbind(p.start),this.$puller.on(p.start,u.bind(this)),this.$puller.unbind(p.end),this.$puller.on(p.end,f.bind(this))}function n(t,i){if(1!==t.length)throw new Error("Command call on set of elements. Only one element must be in set.");var e=t.data("plugin_"+o);if(!e)throw new Error("Command call on non mkPullFresh element");if("destroy"===i)e.destroy();else if("get"===i)return e}var o="mkPullFresh",r={maxShift:100,readyShift:60,refresh:null,pendingShift:60,indicatorHtml:'<div class="mkpf-envelop"><div class="mkpf-indicator-wrapper"><div class="mkpf-indicator"><div class="mkpf-icon-wrapper"><i class="mkpf-arrow-down"></i></div><i class="mkpf-spinner"></i></div></div></div>',emitEvents:!1},h=i.Modernizr&&Modernizr.touch===!0||function(){"use strict";return!!("ontouchstart"in i||i.DocumentTouch&&e instanceof DocumentTouch)}(),l=function(t){return t+"."+o},p=function(){var t={start:l("mousedown"),move:l("mousemove"),end:l("mouseup")};if(h)var t={start:l("touchstart"),move:l("touchmove"),end:l("touchend")};else i.navigator.msPointerEnabled?t={start:l("MSPointerDown"),move:l("MSPointerMove"),end:l("MSPointerUp")}:i.navigator.pointerEnabled&&(t={start:l("pointerdown"),move:l("pointermove"),end:l("pointerup")});return t}();s.prototype={pullStart:function(t){this.puller.setAttribute("data-mkpf-state","active"),this.bubble.style.height=t+"px",this.options.emitEvents&&this.$puller.trigger("mkPullFreshStart",[t,this])},pullProgress:function(t){var i=t>this.options.readyShift?"ready":"active";this.puller.setAttribute("data-mkpf-state",i),t>this.options.maxShift&&(t=this.options.maxShift),t<0&&(t=0),this.bubble.style.height=t+"px",this.options.emitEvents&&this.$puller.trigger("mkPullFreshPull",[t,this])},pullPending:function(t){this.puller.setAttribute("data-mkpf-state","pending"),this.bubble.style.height=(this.options.pendingShift||50)+"px",this.pending=!0,this.options.emitEvents&&this.$puller.trigger("mkPullFreshPending",[this.pullEnd.bind(this),this])},pullEnd:function(){this.bubble.style.height="0px",this.puller.setAttribute("data-mkpf-state","idle"),this.pending=!1,t(e.body).unbind(p.move),this.options.emitEvents&&this.$puller.trigger("mkPullFreshEnd",this)},pointerY:function(t){var i,e=t.type.substr(0,5);return i="touch"===e?(t.targetTouches||t.originalEvent.targetTouches)[0].pageY:t.pageY||t.clientY},destroy:function(){this.puller.removeAttribute("data-mkpf-state"),this.$puller.off(p.start),this.$puller.off(p.move),this.$puller.off("touchend."+o),t(e.body).off(p.move),this.$puller.removeData("plugin_"+o)}};var u=function(i){return!this.pending&&(this.offset.containerToDoc<t(e).scrollTop()||(this.offset.pullerToContainer<this.$container.scrollTop()||(this.pointer.start=this.pointer.y=this.pointerY(i),this.pointer.shift=0,this.$puller.unbind(p.move),this.$puller.on(p.move,a.bind(this)),void this.pullStart(this.pointer.shift))))},a=function(i){this.pointer.y=this.pointerY(i),this.pointer.shift=this.pointer.y-this.pointer.start,this.pointer.shift>1?(this.elast&&(t(e.body).on(p.move,function(t){t.preventDefault()}),this.elast=!1),this.pullProgress(this.pointer.shift)):(t(e.body).unbind(p.move),this.elast=!0)},f=function(){var i=this;this.$puller.unbind(p.move),this.pointer.shift>0&&(this.pointer.shift>this.options.readyShift?(this.pullPending(this.pointer.shift),"function"==typeof this.options.refresh?this.options.refresh.call(this,this.pullEnd.bind(this)):"number"==typeof this.options.refresh?setTimeout(this.pullEnd.bind(this),this.options.refresh):this.options.emitEvents||setTimeout(this.pullEnd.bind(this),1e3)):this.pullEnd(this.pointer.shift)),this.pointer.start=this.pointer.y=this.pointer.shift=null,setTimeout(function(){t(e.body).unbind(p.move),i.elast=!0},300)};t.fn[o]=function(i,e){return"string"==typeof i?n(this,i):("object"==typeof i&&(e=i,i=e.refresh),this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new s(this,i,e))}))}}(jQuery,window,document);